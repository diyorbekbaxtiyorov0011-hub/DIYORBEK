<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Luxury Store | Google Auth & Payments</title>
    <style>
        :root { --gold: #d4af37; --dark: #0a0a0a; --glass: rgba(255,255,255,0.05); }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        
        /* Navbar */
        nav {
            position: fixed; top: 0; width: 100%; padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000;
            border-bottom: 1px solid var(--gold); box-sizing: border-box;
        }

        .user-info { display: flex; align-items: center; gap: 15px; }
        .balance-badge { color: var(--gold); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        
        /* 3D Scene */
        #canvas-container { width: 100vw; height: 60vh; margin-top: 70px; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); }

        /* Store */
        .container { padding: 40px; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: var(--glass); border: 1px solid #222; padding: 20px; border-radius: 15px; text-align: center; }
        .price { color: var(--gold); font-size: 22px; margin: 10px 0; font-weight: bold; }

        /* Admin Panel Modal */
        #admin-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 2000; overflow-y: auto; padding: 40px 20px;
        }
        .admin-content { max-width: 600px; margin: auto; background: #111; padding: 30px; border-radius: 20px; border: 1px solid var(--gold); }
        
        input { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        .btn { background: var(--gold); color: #000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; text-transform: uppercase; }
        
        .pay-btn { padding: 10px; border-radius: 5px; border: none; cursor: pointer; flex: 1; font-weight: bold; color: white; }
    </style>
</head>
<body>

    <nav>
        <div style="font-weight: bold; color: var(--gold); font-size: 20px;">ELITE 3D SHOP</div>
        <div id="auth-ui"><button class="btn" style="width: auto;" onclick="login()">GOOGLE BILAN KIRISH</button></div>
        <div id="user-ui" class="user-info" style="display: none;">
            <div class="balance-badge" onclick="showPayments()">HAMYON: <span id="u-bal">0</span> $</div>
            <button onclick="openAdmin()" style="background:none; border:1px solid #555; color:white; padding:5px 10px; border-radius:5px; cursor:pointer;">ADMIN</button>
            <img id="u-img" style="width:35px; border-radius:50%;" src="">
        </div>
    </nav>

    <div id="canvas-container"></div>

    <div class="container" id="products">
        </div>

    <div id="admin-modal">
        <div class="admin-content">
            <h2 style="color:var(--gold)">BOSHQARUV PANELI</h2>
            
            <div style="margin-bottom: 30px; padding: 15px; border: 1px solid #333; border-radius: 10px;">
                <h3>YANGI MAHSULOT QO'SHISH</h3>
                <input type="text" id="p-name" placeholder="Nomi">
                <input type="number" id="p-price" placeholder="Narxi ($)">
                <input type="text" id="p-url" placeholder="Model linki (.glb)">
                <button class="btn" onclick="saveProduct()">BAZAGA QO'SHISH</button>
            </div>

            <div id="payment-section" style="margin-bottom: 30px;">
                <h3>TO'LOV TIZIMI (DEMO)</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="pay-btn" style="background: #0088cc;" onclick="window.open('https://click.uz')">CLICK</button>
                    <button class="pay-btn" style="background: #00bfa5;" onclick="window.open('https://payme.uz')">PAYME</button>
                </div>
            </div>

            <button class="btn" style="background:#444; color:white" onclick="closeAdmin()">YOPISH</button>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Firebase Config - O'ZINGIZNIKINI SHU YERGA QO'YING
        const firebaseConfig = {
           apiKey: "AIzaSyD2ZyeDAT517538fSljJ581d9yohZ3Td1c",
  authDomain: "portfolio-f332d.firebaseapp.com",
  projectId: "portfolio-f332d",
  storageBucket: "portfolio-f332d.firebasestorage.app",
  messagingSenderId: "327196596703",
  appId: "1:327196596703:web:c8e7bafc0f18bf71b3cc6a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // 2. Auth funksiyalari
        window.login = () => {
            signInWithPopup(auth, provider).then(async (res) => {
                const user = res.user;
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                if (!snap.exists()) {
                    await setDoc(userRef, { name: user.displayName, balance: 0 });
                }
                location.reload();
            });
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('auth-ui').style.display = 'none';
                document.getElementById('user-ui').style.display = 'flex';
                document.getElementById('u-img').src = user.photoURL;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) document.getElementById('u-bal').innerText = snap.data().balance;
            }
        });

        // 3. Admin funksiyalari
        window.openAdmin = () => document.getElementById('admin-modal').style.display = 'block';
        window.closeAdmin = () => document.getElementById('admin-modal').style.display = 'none';
        
        window.saveProduct = async () => {
            const data = {
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                modelUrl: document.getElementById('p-url').value
            };
            await addDoc(collection(db, "products"), data);
            alert("Mahsulot qo'shildi!");
            location.reload();
        };

        // 4. 3D Sahna
        let scene, camera, renderer, controls;
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / (window.innerHeight*0.6), 0.1, 1000);
            camera.position.set(5, 2, 8);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight * 0.6);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            scene.add(new THREE.AmbientLight(0xffffff, 1.5));
            const light = new THREE.PointLight(0xd4af37, 100);
            light.position.set(5, 5, 5);
            scene.add(light);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.autoRotate = true;

            const loader = new GLTFLoader();
            loader.load('free__lamborghini_terzo_millennio.glb', (gltf) => {
                const model = gltf.scene;
                model.scale.set(2.5, 2.5, 2.5);
                scene.add(model);
            });

            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
        }

        async function loadProducts() {
            const snap = await getDocs(collection(db, "products"));
            const div = document.getElementById('products');
            div.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                div.innerHTML += `
                    <div class="card">
                        <h3>${p.name}</h3>
                        <div class="price">${p.price} $</div>
                        <button class="btn">SOTIB OLISH</button>
                    </div>
                `;
            });
        }

        init3D();
        loadProducts();
    </script>
</body>
</html>
